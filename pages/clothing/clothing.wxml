<view class="container">
  <!-- 页面标题 -->
  <view class="top-nav">{{title}}</view>
  
  <!-- 一级分类导航 -->
  <scroll-view class="primary-categories" scroll-x>
    <view 
      class="category-item {{currentPrimaryCategory === '总览' ? 'active' : ''}}" 
      bindtap="switchPrimaryCategory" 
      data-category="总览"
    >
      总览
    </view>
    <block wx:for="{{primaryCategories}}" wx:key="id">
      <view 
        class="category-item {{currentPrimaryCategory === item.id ? 'active' : ''}}" 
        bindtap="switchPrimaryCategory" 
        data-category="{{item.id}}"
      >
        {{item.name}}
      </view>
    </block>
  </scroll-view>
  
  <!-- 二级分类导航 -->
  <scroll-view class="secondary-categories" scroll-x wx:if="{{currentPrimaryCategory !== '总览'}}">
    <view 
      class="subcategory-item {{currentSecondaryCategory === 'all' ? 'active' : ''}}" 
      bindtap="switchSecondaryCategory" 
      data-category="all"
    >
      全部
    </view>
    <block wx:for="{{secondaryCategories}}" wx:key="id">
      <view 
        class="subcategory-item {{currentSecondaryCategory === item.id ? 'active' : ''}}" 
        bindtap="switchSecondaryCategory" 
        data-category="{{item.id}}"
      >
        {{item.name}}
      </view>
    </block>
  </scroll-view>
  
  <!-- 颜色筛选 -->
  <scroll-view class="color-filter" scroll-x wx:if="{{currentPrimaryCategory !== '总览'}}">
    <view 
      class="color-item {{selectedColor === '' ? 'active' : ''}}" 
      bindtap="selectColor" 
      data-color=""
    >
      全部颜色
    </view>
    <block wx:for="{{colorOptions}}" wx:key="index">
      <view 
        class="color-item {{selectedColor === item ? 'active' : ''}}" 
        bindtap="selectColor" 
        data-color="{{item}}"
      >
        {{item}}
      </view>
    </block>
  </scroll-view>
  
  <!-- 季节筛选 -->
  <scroll-view class="season-filter" scroll-x wx:if="{{currentPrimaryCategory !== '总览'}}">
    <view 
      class="season-item {{selectedSeason === '' ? 'active' : ''}}" 
      bindtap="selectSeason" 
      data-season=""
    >
      全部季节
    </view>
    <block wx:for="{{seasonOptions}}" wx:key="index">
      <view 
        class="season-item {{selectedSeason === item ? 'active' : ''}}" 
        bindtap="selectSeason" 
        data-season="{{item}}"
      >
        {{item}}
      </view>
    </block>
  </scroll-view>
  
  <!-- 衣物列表 -->
  <scroll-view class="clothing-list" scroll-y>
    <block wx:if="{{filteredClothingList.length > 0}}">
      <block wx:for="{{filteredClothingList}}" wx:key="id">
        <view class="clothing-card" bindtap="goToDetail" data-id="{{item.id}}" bindlongpress="onLongPressClothing">
          <image class="clothing-img" src="{{item.image_url}}" mode="aspectFill" wx:if="{{item.image_url}}"></image>
          <view class="clothing-info">
            <view class="clothing-name">{{item.name}}</view>
            <view class="clothing-category">{{item.primary_category}} - {{item.secondary_category}}</view>
            <view class="clothing-meta">
              <text wx:if="{{item.color}}">{{item.color}}</text>
              <text wx:if="{{item.season}}"> | {{item.season}}</text>
              <text wx:if="{{item.brand}}"> | {{item.brand}}</text>
            </view>
          </view>
        </view>
      </block>
    </block>
    
    <!-- 空状态 -->
    <view class="empty-state" wx:else>
      <text class="empty-text">暂无衣物数据</text>
    </view>
  </scroll-view>
  
  <!-- 批量操作工具栏 -->
  <view class="batch-toolbar" wx:if="{{isBatchMode}}">
    <view class="batch-info">已选择 {{selectedClothingIds.length}} 件衣物</view>
    <view class="batch-actions">
      <button class="batch-btn" bindtap="batchDeleteClothing">删除</button>
      <button class="batch-btn" bindtap="batchMoveCategory">移动分类</button>
      <button class="batch-btn cancel" bindtap="exitBatchMode">取消</button>
    </view>
  </view>
  
  <!-- 悬浮添加按钮 -->
  <view class="fab" bindtap="showAddModal">
    <text>＋</text>
  </view>
  
  <!-- 新增服装选择弹窗 -->
  <view class="modal" wx:if="{{showAddOptionsModal}}">
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">新增服装</text>
        <text class="close-btn" bindtap="hideAddOptionsModal">×</text>
      </view>
      <view class="modal-body">
        <button class="option-btn" bindtap="showManualAddModal">手动填写</button>
        <button class="option-btn" bindtap="chooseTakePhoto">拍照识别</button>
      </view>
    </view>
  </view>
  
  <!-- 手动添加弹窗 -->
  <view class="modal" wx:if="{{showModal}}">
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">添加衣物</text>
        <text class="close-btn" bindtap="hideAddModal">×</text>
      </view>
      <form class="modal-form" bindsubmit="addClothing">
        <view class="form-item">
          <text class="label">名称 *</text>
          <input class="input" name="name" value="{{name}}" bindinput="onNameInput" placeholder="请输入衣物名称" />
        </view>
        
        <view class="form-item">
          <text class="label">一级分类 *</text>
          <picker mode="selector" range="{{primaryCategories}}" range-key="name" value="{{primaryCategoryIndex}}" bindchange="onPrimaryCategoryChange">
            <view class="picker">
              {{primaryCategoryIndex >= 0 ? primaryCategories[primaryCategoryIndex].name : '请选择一级分类'}}
            </view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="label">二级分类</text>
          <picker mode="selector" range="{{secondaryCategoryOptions}}" range-key="name" value="{{secondaryCategoryIndex}}" bindchange="onSecondaryCategoryChange">
            <view class="picker">
              {{secondaryCategoryIndex >= 0 ? secondaryCategoryOptions[secondaryCategoryIndex].name : '请选择二级分类'}}
            </view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="label">颜色</text>
          <picker mode="selector" range="{{colorOptions}}" value="{{colorIndex}}" bindchange="onColorChange">
            <view class="picker">
              {{colorOptions[colorIndex]}}
            </view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="label">适用季节</text>
          <picker mode="selector" range="{{seasonOptions}}" value="{{seasonIndex}}" bindchange="onSeasonChange">
            <view class="picker">
              {{seasonOptions[seasonIndex]}}
            </view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="label">品牌</text>
          <input class="input" name="brand" value="{{brand}}" bindinput="onBrandInput" placeholder="请输入品牌" />
        </view>
        
        <view class="form-item">
          <text class="label">价格</text>
          <input class="input" type="digit" name="price" value="{{price}}" bindinput="onPriceInput" placeholder="请输入价格" />
        </view>
        
        <view class="form-item">
          <text class="label">购买日期</text>
          <picker mode="date" value="{{purchaseDate}}" bindchange="bindDateChange">
            <view class="picker">
              {{purchaseDate ? purchaseDate : '请选择日期'}}
            </view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="label">图片</text>
          <view class="image-upload" bindtap="chooseImage">
            <image wx:if="{{imageUrl}}" src="{{imageUrl}}" class="preview-image"></image>
            <view wx:else class="upload-placeholder">＋ 上传图片</view>
          </view>
        </view>
        
        <button class="submit-btn" form-type="submit">确定</button>
      </form>
    </view>
  </view>
  
  <!-- 搜索弹窗 -->
  <view class="modal" wx:if="{{showSearchModal}}">
    <view class="modal-content search-modal">
      <view class="modal-header">
        <text class="modal-title">搜索衣物</text>
        <text class="close-btn" bindtap="hideSearch">×</text>
      </view>
      <view class="search-bar">
        <input
          class="search-input"
          placeholder="搜索衣物名称"
          value="{{searchKeyword}}"
          bindinput="onSearchInput"
          bindconfirm="onSearchConfirm"
          confirm-type="search"
        />
        <button class="search-btn" bindtap="onSearch">搜索</button>
      </view>
      <scroll-view class="search-results" scroll-y wx:if="{{searchResults.length > 0}}">
        <block wx:for="{{searchResults}}" wx:key="id">
          <view class="search-result-item" bindtap="goToDetail" data-id="{{item.id}}">
            <text>{{item.name}}</text>
          </view>
        </block>
      </scroll-view>
      <view class="empty-state" wx:elif="{{searchKeyword && searchResults.length === 0}}">
        <text class="empty-text">未找到相关衣物</text>
      </view>
    </view>
  </view>
</view>