<view class="container">
  
  <!-- æˆå‘˜é€‰æ‹©æŒ‰é’® - æ‚¬æµ®åœ¨å³ä¸Šè§’ -->
  <view class="member-float-btn" bindtap="toggleMemberDropdown">
    <image 
      class="member-avatar" 
      src="{{getSelectedMemberAvatar()}}" 
      mode="aspectFit"
      wx:if="{{getSelectedMemberAvatar()}}"
    ></image>
    <view class="member-avatar placeholder" wx:else>
      <text class="avatar-text">?</text>
    </view>
  </view>
  
  <!-- æˆå‘˜ä¸‹æ‹‰èœå• -->
  <view class="member-dropdown" wx:if="{{showMemberDropdown}}">
    <view class="dropdown-item {{item.memberid === selectedMemberId ? 'selected' : ''}}" wx:for="{{members}}" wx:key="memberid" bindtap="switchMember" data-id="{{item.memberid}}">
      <image 
        class="dropdown-member-avatar" 
        src="{{item.avatar_url}}" 
        mode="aspectFit"
        wx:if="{{item.avatar_url}}"
      ></image>
      <view class="dropdown-member-avatar placeholder" wx:else>
        <text class="avatar-text">?</text>
      </view>
      <view class="member-info">
        <text class="member-item-name">{{item.name}}</text>
        <text class="member-item-info">{{item.gender === 1 ? 'ç”·' : item.gender === 2 ? 'å¥³' : item.gender}} | {{item.ageGroup}}</text>
      </view>
      <view class="selected-indicator" wx:if="{{item.memberid === selectedMemberId}}">
        <text class="selected-icon">âœ“</text>
      </view>
    </view>
  </view>
  
  <!-- Tabå¯¼èˆªæ  -->
  <view class="tab-bar">
    <view 
      class="tab-item {{currentTab === 'wardrobe' ? 'active' : ''}}" 
      bindtap="switchTab" 
      data-tab="wardrobe"
    >
      æ©±æŸœ
    </view>
    <view 
      class="tab-item {{currentTab === 'outfit' ? 'active' : ''}}" 
      bindtap="switchTab" 
      data-tab="outfit"
    >
      ç©¿æ­
    </view>
  </view>
  
  <!-- ä¸€çº§åˆ†ç±»å¯¼èˆª -->
  <scroll-view class="primary-categories" scroll-x wx:if="{{currentTab === 'wardrobe'}}">
    <view 
      class="category-item {{currentPrimaryCategory === 'æ€»è§ˆ' ? 'active' : ''}}" 
      bindtap="switchPrimaryCategory" 
      data-category="æ€»è§ˆ"
    >
      æ€»è§ˆ
    </view>
    <block wx:for="{{primaryCategories}}" wx:key="id">
      <view 
        class="category-item {{currentPrimaryCategory === item.id ? 'active' : ''}}" 
        bindtap="switchPrimaryCategory" 
        data-category="{{item.id}}"
      >
        {{item.name}}
      </view>
    </block>
  </scroll-view>
  
  <!-- äºŒçº§åˆ†ç±»å¯¼èˆª -->
  <scroll-view class="secondary-categories" scroll-x wx:if="{{currentTab === 'wardrobe'}}">
    <view 
      class="subcategory-item {{currentSecondaryCategory === 'all' ? 'active' : ''}}" 
      bindtap="switchSecondaryCategory" 
      data-category="all"
    >
      å…¨éƒ¨
    </view>
    <block wx:for="{{currentSecondaryCategories}}" wx:key="id">
      <view 
        class="subcategory-item {{currentSecondaryCategory === item.id ? 'active' : ''}}" 
        bindtap="switchSecondaryCategory" 
        data-category="{{item.id}}"
      >
        {{item.name}}
      </view>
    </block>
  </scroll-view>
  
  <!-- é¢œè‰²ç­›é€‰ -->
<!--  <scroll-view class="color-filter" scroll-x wx:if="{{currentTab === 'wardrobe'}}">-->
<!--    <view -->
<!--      class="color-item {{selectedColor === '' ? 'active' : ''}}" -->
<!--      bindtap="selectColor" -->
<!--      data-color=""-->
<!--    >-->
<!--      å…¨éƒ¨-->
<!--    </view>-->
<!--    <block wx:for="{{colorOptions}}" wx:key="index">-->
<!--      <view -->
<!--        class="color-circle-item {{selectedColor === item ? 'active' : ''}}" -->
<!--        bindtap="selectColor" -->
<!--        data-color="{{item}}"-->
<!--        style="background-color: {{getColorValue(item)}} !important;"-->
<!--      >-->
<!--      </view>-->
<!--    </block>-->
<!--  </scroll-view>-->
  
  <!-- å­£èŠ‚ç­›é€‰ -->
  <scroll-view class="season-filter" scroll-x wx:if="{{currentTab === 'wardrobe'}}">
    <view 
      class="season-item {{selectedSeason === '' ? 'active' : ''}}" 
      bindtap="selectSeason" 
      data-season=""
    >
      å…¨éƒ¨
    </view>
    <block wx:for="{{seasonOptions}}" wx:key="index">
      <view 
        class="season-item {{selectedSeason === item ? 'active' : ''}}" 
        bindtap="selectSeason" 
        data-season="{{item}}"
      >
        {{item}}
      </view>
    </block>
  </scroll-view>
  
  <!-- è¡£ç‰©åˆ—è¡¨ -->
  <scroll-view class="clothing-list" scroll-y>
    <view wx:if="{{filteredClothingList.length > 0}}" class="clothing-list-container">
      <block wx:for="{{filteredClothingList}}" wx:key="id">
        <view class="clothing-card" bindtap="goToDetail" data-id="{{item.id || item._id}}" data-item="{{item}}" bindlongpress="onLongPressClothing">
          <image class="clothing-img" src="{{item.image_url}}" mode="aspectFit"></image>
          <view class="clothing-info">
            <view class="clothing-name">{{item.name}}</view>
            <view class="clothing-category">{{item.primary_category}} - {{item.secondary_category}}</view>
            <view class="clothing-meta">
              <text wx:if="{{item.color}}">{{item.color}}</text>
              <text wx:if="{{item.season}}"> | {{item.season}}</text>
              <text wx:if="{{item.brand}}"> | {{item.brand}}</text>
              <text wx:if="{{item.size}}"> | {{item.size}}</text>
            </view>
            <view class="clothing-price" wx:if="{{item.price}}">Â¥{{item.price}}</view>
          </view>
        </view>
      </block>
    </view>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:else>
      <text class="empty-text" wx:if="{{currentTab === 'wardrobe'}}">æš‚æ— è¡£ç‰©æ•°æ®</text>
      <text class="empty-text" wx:else>æš‚æ— ç©¿æ­æ•°æ®</text>
    </view>
  </scroll-view>
  
  <!-- æ‰¹é‡æ“ä½œå·¥å…·æ  -->
  <view class="batch-toolbar" wx:if="{{isBatchMode}}">
    <view class="batch-info">å·²é€‰æ‹© {{selectedClothingIds.length}} ä»¶è¡£ç‰©</view>
    <view class="batch-actions">
      <button class="batch-btn" bindtap="batchDeleteClothing">åˆ é™¤</button>
      <button class="batch-btn" bindtap="batchMoveCategory">ç§»åŠ¨åˆ†ç±»</button>
      <button class="batch-btn cancel" bindtap="exitBatchMode">å–æ¶ˆ</button>
    </view>
  </view>
  
  <!-- åˆ†ç±»é€‰æ‹©æ¨¡æ€æ¡† -->
  <view class="modal {{showCategoryModal ? 'modal-visible' : ''}}">
    <view class="modal-content category-modal">
      <view class="modal-header">
        <text class="modal-title">é€‰æ‹©åˆ†ç±»</text>
        <text class="close-btn" bindtap="hideCategoryModal">Ã—</text>
      </view>
      <view class="modal-body-container">
        <scroll-view class="modal-body-scroll" scroll-y>
          <view class="modal-body">
            <!-- ä¸€çº§åˆ†ç±»é€‰æ‹© -->
            <view class="form-group" wx:if="{{!selectedPrimaryCategory}}">
              <view class="label">è¯·é€‰æ‹©ä¸€çº§åˆ†ç±»</view>
              <view class="category-list">
                <view 
                  class="category-option {{item.id === selectedPrimaryCategory ? 'active' : ''}}" 
                  wx:for="{{primaryCategories}}" 
                  wx:key="id"
                  bindtap="selectPrimaryCategory"
                  data-id="{{item.id}}"
                  data-name="{{item.name}}"
                >
                  {{item.name}}
                </view>
              </view>
            </view>
            
            <!-- äºŒçº§åˆ†ç±»é€‰æ‹© -->
            <view class="form-group" wx:if="{{selectedPrimaryCategory && currentSecondaryCategories.length > 0}}">
              <view class="label">è¯·é€‰æ‹©äºŒçº§åˆ†ç±»</view>
              <view class="back-to-primary">
                <text class="back-text" bindtap="backToPrimaryCategory">â† è¿”å›</text>
              </view>
              <view class="category-list">
                <view 
                  class="category-option {{item.id === selectedSecondaryCategory ? 'active' : ''}}" 
                  wx:for="{{currentSecondaryCategories}}" 
                  wx:key="id"
                  bindtap="selectSecondaryCategory"
                  data-id="{{item.id}}"
                  data-name="{{item.name}}"
                >
                  {{item.name}}
                </view>
              </view>
            </view>
            
            <!-- æ— äºŒçº§åˆ†ç±»æç¤º -->
            <view class="form-group" wx:if="{{selectedPrimaryCategory && currentSecondaryCategories.length === 0}}">
              <view class="no-secondary-category">è¯¥ä¸€çº§åˆ†ç±»ä¸‹æ— äºŒçº§åˆ†ç±»</view>
            </view>
          </view>
        </scroll-view>
        
        <!-- æ“ä½œæŒ‰é’® -->
        <view class="modal-actions">
          <button class="btn cancel" bindtap="hideCategoryModal">å–æ¶ˆ</button>
          <button 
            class="btn confirm" 
            bindtap="confirmCategorySelection"
            wx:if="{{selectedPrimaryCategory && (!currentSecondaryCategories.length || selectedSecondaryCategory)}}"
          >
            ç¡®å®š
          </button>
        </view>
      </view>
    </view>
  </view>
  
  <!-- æ‚¬æµ®æ·»åŠ æŒ‰é’® -->
  <view class="fab" bindtap="showAddModal" wx:if="{{currentTab === 'wardrobe'}}">
    <text>ï¼‹</text>
  </view>
  
  <!-- ç©¿æ­æ·»åŠ æŒ‰é’® -->
  <view class="fab" bindtap="showOutfitAddModal" wx:if="{{currentTab === 'outfit'}}">
    <text>ï¼‹</text>
  </view>
  
  <!-- æ·»åŠ é€‰é¡¹å¼¹çª— -->
  <view class="modal modal-visible" wx:if="{{showAddOptionsModal}}">
    <view class="modal-content add-options-modal">
      <view class="modal-header">
        <text class="modal-title">æ·»åŠ è¡£ç‰©</text>
        <text class="close-btn" bindtap="hideAddOptionsModal">Ã—</text>
      </view>
      <view class="modal-body">
        <view class="add-option-item" bindtap="chooseImageRecognition">
          <text class="option-icon">ğŸ“¸</text>
          <text class="option-text">å›¾ç‰‡è¯†åˆ«</text>
        </view>
        <view class="add-option-item" bindtap="chooseManualAdd">
          <text class="option-icon">âœï¸</text>
          <text class="option-text">æ‰‹åŠ¨æ·»åŠ </text>
        </view>
      </view>
    </view>
  </view>
  


  <!-- æœç´¢å¼¹çª— -->
  <view class="modal" wx:if="{{showSearchModal}}">
    <view class="modal-content search-modal">
      <view class="modal-header">
        <text class="modal-title">æœç´¢è¡£ç‰©</text>
        <text class="close-btn" bindtap="hideSearch">Ã—</text>
      </view>
      <view class="search-bar">
        <input
          class="search-input"
          placeholder="æœç´¢è¡£ç‰©åç§°"
          value="{{searchKeyword}}"
          bindinput="onSearchInput"
          bindconfirm="onSearchConfirm"
          confirm-type="search"
        />
        <button class="search-btn" bindtap="onSearch">æœç´¢</button>
      </view>
      <scroll-view class="search-results" scroll-y wx:if="{{searchResults.length > 0}}">
        <block wx:for="{{searchResults}}" wx:key="id">
          <view class="search-result-item" bindtap="goToDetail" data-id="{{item.id}}">
            <text>{{item.name}}</text>
          </view>
        </block>
      </scroll-view>
      <view class="empty-state" wx:elif="{{searchKeyword && searchResults.length === 0}}">
        <text class="empty-text">æœªæ‰¾åˆ°ç›¸å…³è¡£ç‰©</text>
      </view>
    </view>
  </view>
</view>