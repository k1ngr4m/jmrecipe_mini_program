<view class="container">
  
  <!-- 成员选择按钮 - 悬浮在右上角 -->
  <view class="member-float-btn" bindtap="toggleMemberDropdown">
    <image 
      class="member-avatar" 
      src="{{getSelectedMemberAvatar()}}" 
      mode="aspectFill"
      wx:if="{{getSelectedMemberAvatar()}}"
    ></image>
    <view class="member-avatar placeholder" wx:else>
      <text class="avatar-text">?</text>
    </view>
  </view>
  
  <!-- 成员下拉菜单 -->
  <view class="member-dropdown" wx:if="{{showMemberDropdown}}">
    <view class="dropdown-item {{item.memberid === selectedMemberId ? 'selected' : ''}}" wx:for="{{members}}" wx:key="memberid" bindtap="switchMember" data-id="{{item.memberid}}">
      <image 
        class="dropdown-member-avatar" 
        src="{{item.avatar_url}}" 
        mode="aspectFill"
        wx:if="{{item.avatar_url}}"
      ></image>
      <view class="dropdown-member-avatar placeholder" wx:else>
        <text class="avatar-text">?</text>
      </view>
      <view class="member-info">
        <text class="member-item-name">{{item.name}}</text>
        <text class="member-item-info">{{item.gender === 1 ? '男' : item.gender === 2 ? '女' : item.gender}} | {{item.ageGroup}}</text>
      </view>
      <view class="selected-indicator" wx:if="{{item.memberid === selectedMemberId}}">
        <text class="selected-icon">✓</text>
      </view>
    </view>
  </view>
  
  <!-- 一级分类导航 -->
  <scroll-view class="primary-categories" scroll-x>
    <view 
      class="category-item {{currentPrimaryCategory === '总览' ? 'active' : ''}}" 
      bindtap="switchPrimaryCategory" 
      data-category="总览"
    >
      总览
    </view>
    <block wx:for="{{primaryCategories}}" wx:key="id">
      <view 
        class="category-item {{currentPrimaryCategory === item.id ? 'active' : ''}}" 
        bindtap="switchPrimaryCategory" 
        data-category="{{item.id}}"
      >
        {{item.name}}
      </view>
    </block>
  </scroll-view>
  
  <!-- 二级分类导航 -->
  <scroll-view class="secondary-categories" scroll-x>
    <view 
      class="subcategory-item {{currentSecondaryCategory === 'all' ? 'active' : ''}}" 
      bindtap="switchSecondaryCategory" 
      data-category="all"
    >
      全部
    </view>
    <block wx:for="{{currentSecondaryCategories}}" wx:key="id">
      <view 
        class="subcategory-item {{currentSecondaryCategory === item.id ? 'active' : ''}}" 
        bindtap="switchSecondaryCategory" 
        data-category="{{item.id}}"
      >
        {{item.name}}
      </view>
    </block>
  </scroll-view>
  
  <!-- 颜色筛选 -->
<!--  <scroll-view class="color-filter" scroll-x>-->
<!--    <view -->
<!--      class="color-item {{selectedColor === '' ? 'active' : ''}}" -->
<!--      bindtap="selectColor" -->
<!--      data-color=""-->
<!--    >-->
<!--      全部-->
<!--    </view>-->
<!--    <block wx:for="{{colorOptions}}" wx:key="index">-->
<!--      <view -->
<!--        class="color-circle-item {{selectedColor === item ? 'active' : ''}}" -->
<!--        bindtap="selectColor" -->
<!--        data-color="{{item}}"-->
<!--        style="background-color: {{getColorValue(item)}} !important;"-->
<!--      >-->
<!--      </view>-->
<!--    </block>-->
<!--  </scroll-view>-->
  
  <!-- 季节筛选 -->
  <scroll-view class="season-filter" scroll-x>
    <view 
      class="season-item {{selectedSeason === '' ? 'active' : ''}}" 
      bindtap="selectSeason" 
      data-season=""
    >
      全部
    </view>
    <block wx:for="{{seasonOptions}}" wx:key="index">
      <view 
        class="season-item {{selectedSeason === item ? 'active' : ''}}" 
        bindtap="selectSeason" 
        data-season="{{item}}"
      >
        {{item}}
      </view>
    </block>
  </scroll-view>
  
  <!-- 衣物列表 -->
  <scroll-view class="clothing-list" scroll-y>
    <view wx:if="{{filteredClothingList.length > 0}}" class="clothing-list-container">
      <block wx:for="{{filteredClothingList}}" wx:key="id">
        <view class="clothing-card" bindtap="goToDetail" data-id="{{item.id || item._id}}" data-item="{{item}}" bindlongpress="onLongPressClothing">
          <image class="clothing-img" src="{{item.image_url}}" mode="aspectFill"></image>
          <view class="clothing-info">
            <view class="clothing-name">{{item.name}}</view>
            <view class="clothing-category">{{item.primary_category}} - {{item.secondary_category}}</view>
            <view class="clothing-meta">
              <text wx:if="{{item.color}}">{{item.color}}</text>
              <text wx:if="{{item.season}}"> | {{item.season}}</text>
              <text wx:if="{{item.brand}}"> | {{item.brand}}</text>
            </view>
          </view>
        </view>
      </block>
    </view>
    
    <!-- 空状态 -->
    <view class="empty-state" wx:else>
      <text class="empty-text">暂无衣物数据</text>
    </view>
  </scroll-view>
  
  <!-- 批量操作工具栏 -->
  <view class="batch-toolbar" wx:if="{{isBatchMode}}">
    <view class="batch-info">已选择 {{selectedClothingIds.length}} 件衣物</view>
    <view class="batch-actions">
      <button class="batch-btn" bindtap="batchDeleteClothing">删除</button>
      <button class="batch-btn" bindtap="batchMoveCategory">移动分类</button>
      <button class="batch-btn cancel" bindtap="exitBatchMode">取消</button>
    </view>
  </view>
  
  <!-- 悬浮添加按钮 -->
  <view class="fab" bindtap="showAddModal">
    <text>＋</text>
  </view>
  
  <!-- 添加选项弹窗 -->
  <view class="modal" wx:if="{{showAddOptionsModal}}">
    <view class="modal-content add-options-modal">
      <view class="modal-header">
        <text class="modal-title">添加衣物</text>
        <text class="close-btn" bindtap="hideAddOptionsModal">×</text>
      </view>
      <view class="modal-body">
        <view class="add-option-item" bindtap="chooseImageRecognition">
          <text class="option-icon">📸</text>
          <text class="option-text">图片识别</text>
        </view>
        <view class="add-option-item" bindtap="chooseManualAdd">
          <text class="option-icon">✍️</text>
          <text class="option-text">手动添加</text>
        </view>
      </view>
    </view>
  </view>
  


  <!-- 搜索弹窗 -->
  <view class="modal" wx:if="{{showSearchModal}}">
    <view class="modal-content search-modal">
      <view class="modal-header">
        <text class="modal-title">搜索衣物</text>
        <text class="close-btn" bindtap="hideSearch">×</text>
      </view>
      <view class="search-bar">
        <input
          class="search-input"
          placeholder="搜索衣物名称"
          value="{{searchKeyword}}"
          bindinput="onSearchInput"
          bindconfirm="onSearchConfirm"
          confirm-type="search"
        />
        <button class="search-btn" bindtap="onSearch">搜索</button>
      </view>
      <scroll-view class="search-results" scroll-y wx:if="{{searchResults.length > 0}}">
        <block wx:for="{{searchResults}}" wx:key="id">
          <view class="search-result-item" bindtap="goToDetail" data-id="{{item.id}}">
            <text>{{item.name}}</text>
          </view>
        </block>
      </scroll-view>
      <view class="empty-state" wx:elif="{{searchKeyword && searchResults.length === 0}}">
        <text class="empty-text">未找到相关衣物</text>
      </view>
    </view>
  </view>
</view>